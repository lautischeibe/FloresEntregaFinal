<main class="product-detail">
  <section class="product-card">
    <h1>{{product.title}}</h1>
    <img
      src="/img/{{product.thumbnails}}"
      alt="{{product.title}}"
      style="width: 300px; height: auto;"
    />
    <p><strong>Descripción:</strong> {{product.description}}</p>
    <p><strong>Precio:</strong> ${{product.price}}</p>
    <p><strong>Categoría:</strong> {{product.category}}</p>
    <p><strong>Stock disponible:</strong> {{product.stock}}</p>

    <button onclick="addToCart(null, '{{product._id}}')">
      Agregar al carrito
    </button>
  </section>
</main>

<script>
  // Recupera el carrito activo del localStorage
  let activeCartId = localStorage.getItem('activeCart') || null;

  async function addToCart(cartId, productId) {
    cartId = cartId || activeCartId;

    if (!cartId) {
      alert('Seleccioná un carrito antes de agregar productos.');
      return;
    }

    try {
      const res = await fetch(
        `/api/carts/${cartId}/products/${productId}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ quantity: 1 })
        }
      );
      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.message || 'Error al agregar al carrito');
      }
      alert('Producto agregado correctamente al carrito.');
    } catch (err) {
      console.error('Error al agregar producto:', err);
      alert(`Error: ${err.message}`);
    }
  }
</script>

